<project name="macros" default="" basedir=".">
	
	<macrodef name="printCurrentTime" description="prints current time">
   	<attribute name="point" />
	<sequential>
		<tstamp prefix="@{point}">
		     <format property="touch.time" pattern="MM/dd/yyyy hh:mm:ss aa" />
		</tstamp>
		<echo message="@{point} : ${@{point}.touch.time}" />		
	</sequential>
	</macrodef>

	<macrodef name="countlines" description="counts lines and sets the property with the number">
	   	<attribute name="file" />
	   	<attribute name="property" />
             	<sequential>
           	<java fork="true" classname="randoop.main.utilities.CountLines" classpath="${classpath};${destdir}" outputproperty="@{property}">
           		<arg line="@{file}"/>
             	</java>
   		</sequential>
	</macrodef>

	<macrodef name="deleteLines" description="copies a to b and removes lines that contain pattern">
 	<attribute name="src.file" />
	<attribute name="dst.file" />
	<attribute name="patt" />
	<sequential>
           	<java fork="true" classname="randoop.main.utilities.DeleteMatchingLines" classpath="${classpath};${destdir}">
           	 <arg line="--in=@{src.file} --out=@{dst.file} --pattern=@{patt}"/>
             	</java>		
	</sequential>
	</macrodef>

        <macrodef name="deleteLibLines" description="delete lines starting with java or javax or gnu in place from a file">
          <attribute name="filename" />
          <sequential>
            <deleteLines src.file="@{filename}" dst.file="@{filename}" patt="^(javax?|gnu|junit|sun|jtb|org\.xml)\..*" />
          </sequential>
        </macrodef>
	
	<macrodef name="retainLines" description="copies a to b and leaves only lines that contain pattern">
   	  <attribute name="src.file" />
	  <attribute name="dst.file" />
	  <attribute name="patt" />
   	  <sequential>
   	  	<copy overwrite="true" file="@{src.file}" tofile="@{dst.file}">
 		  <filterchain>
	   	<linecontainsregexp>
   		  <regexp pattern="@{patt}"/>
   	  	</linecontainsregexp>
		  </filterchain>
   	  	</copy>
	  </sequential>
	</macrodef>
			
	<macrodef name="diff" description="Diffs 2 files. Fails if they're not equal.">
		<attribute name="expectedFile" />
		<attribute name="actualFile" />
		<sequential>
		<echo message="Diffing files: @{actualFile} and @{expectedFile}" />
		<if>
			<filesmatch file1="@{actualFile}" file2="@{expectedFile}" />
			<then>
                          <echo message="Files have equal contents" />
			</then>
                        <else>
                          <echo message="Files: @{actualFile} and @{expectedFile} are different:" />
                          <exec os="Linux" executable="/usr/bin/diff">
                            <arg value="-u" />
                            <arg value="@{actualFile}" />
                            <arg value="@{expectedFile}" />
                          </exec>
                          <fail message="Files: @{actualFile} and @{expectedFile} are different" />
			</else>
		</if>
		</sequential>
	</macrodef>
	
	<macrodef name="getFilenames" description="set property with names of files in given dir">
   	<attribute name="dir" />
   	<attribute name="pattern" />
  	<attribute name="property" />
	<sequential>
	 <delete file="@{property}"/>
	 <for param="file">
	   <path>
	     <fileset dir="@{dir}" includes="@{pattern}"/>
	   </path>
	  <sequential>
	     <echo message="@{file} " append="true" file="@{property}"/>
	  </sequential>
         </for>
         <loadfile property="@{property}" srcfile="@{property}"/>
       	 <delete file="@{property}"/>
	</sequential>
	</macrodef>	
</project>